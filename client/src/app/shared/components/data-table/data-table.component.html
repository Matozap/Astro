<div class="table-container">
  @if (loading) {
    <mat-progress-bar mode="indeterminate" class="loading-bar"></mat-progress-bar>
  }

  <table
    mat-table
    [dataSource]="data"
    matSort
    (matSortChange)="onSortChange($event)"
    class="data-table"
  >
    @for (column of columns; track column.field) {
      <ng-container [matColumnDef]="column.field">
        <th
          mat-header-cell
          *matHeaderCellDef
          [mat-sort-header]="column.sortable ? column.field : ''"
          [disabled]="!column.sortable"
        >
          {{ column.header }}
        </th>
        <td mat-cell *matCellDef="let row">
          @if (column.template) {
            <ng-container
              *ngTemplateOutlet="column.template; context: { $implicit: row, value: getCellValue(row, column.field) }"
            ></ng-container>
          } @else {
            {{ getCellValue(row, column.field) }}
          }
        </td>
      </ng-container>
    }

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      (click)="onRowClick(row)"
      class="table-row"
    ></tr>

    <tr class="mat-row no-data-row" *matNoDataRow>
      <td class="mat-cell" [attr.colspan]="displayedColumns.length">
        <div class="no-data">
          @if (loading) {
            Loading...
          } @else {
            No data available
          }
        </div>
      </td>
    </tr>
  </table>

  <mat-paginator
    [length]="totalCount"
    [pageSize]="pageSize"
    [pageIndex]="pageIndex"
    [pageSizeOptions]="pageSizeOptions"
    (page)="onPageChange($event)"
    showFirstLastButtons
  ></mat-paginator>
</div>
